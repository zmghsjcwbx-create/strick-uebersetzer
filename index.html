<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>ğŸ”§ PLACEHOLDER_BROWSER_TITLE_HIER_EINSETZEN</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #f8fafc; --card-bg: #ffffff; --accent: #3b82f6; --text: #1e293b;
      --error-bg: #fef2f2; --error-text: #dc2626; --warning-bg: #fef3c7; --warning-text: #d97706;
      --border: #e2e8f0; --text-muted: #64748b; --output-bg: #f0f9ff;
    }
    [data-theme="dark"] { 
      --bg: #0f172a; --card-bg: #1e293b; --accent: #60a5fa; --text: #f1f5f9; 
      --border: #334155; --text-muted: #94a3b8; --error-bg: #451a03; --error-text: #f87171; 
      --warning-bg: #422006; --warning-text: #facc15; --output-bg: #1e40af20;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; padding: 20px; max-width: 1000px; margin: 0 auto; }
    
    .top-bar { position: fixed; top: 0; left: 0; right: 0; background: var(--card-bg); border-bottom: 1px solid var(--border); padding: 12px 20px; z-index: 100; display: flex; justify-content: flex-end; gap: 16px; }
    .toggle-group { display: flex; gap: 12px; align-items: center; font-size: 0.9rem; }
    .font-btn { padding: 8px 14px; border: 1px solid var(--border); border-radius: 8px; background: none; cursor: pointer; transition: all 0.2s; font-weight: 500; }
    .font-btn.active, .font-btn:hover { background: var(--accent); color: white; border-color: var(--accent); }
    
    .card { background: var(--card-bg); border-radius: 16px; padding: 28px; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid var(--border); }
    
    /* PROMINENTE AUSGABE */
    .output-card { 
      min-height: 350px; padding: 40px !important; margin: 32px 0 !important; 
      background: linear-gradient(135deg, var(--output-bg) 0%, rgba(59,130,246,0.08) 100%) !important; 
      border: 3px solid var(--accent) !important; box-shadow: 0 12px 40px rgba(59,130,246,0.2) !important;
      border-radius: 24px !important; position: relative;
    }
    [data-theme="dark"] .output-card { background: linear-gradient(135deg, var(--output-bg) 0%, rgba(30,64,175,0.3) 100%) !important; }
    .output-card::before {
      content: 'ğŸ¯ ÃœBERSETZUNGSERGEBNIS'; position: absolute; top: 20px; right: 28px; 
      background: var(--accent); color: white; padding: 10px 24px; border-radius: 25px;
      font-size: 0.9rem; font-weight: 800; letter-spacing: 1px; box-shadow: 0 4px 12px rgba(59,130,246,0.4);
    }
    
    /* OUTPUT SECTIONS */
    .output-section { margin: 32px 0; padding: 28px; background: rgba(255,255,255,0.9); border-radius: 20px; border-left: 8px solid; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    [data-theme="dark"] .output-section { background: rgba(255,255,255,0.15); }
    .output-section.de { border-left-color: #10b981; }
    .output-section.en { border-left-color: #f59e0b; }
    .output-section.fr { border-left-color: #8b5cf6; }
    .output-section.warning { border-left-color: var(--warning-text); background: var(--warning-bg) !important; }
    .output-section.error { border-left-color: var(--error-text); background: var(--error-bg) !important; }
    
    .output-title { font-size: 1.8rem; font-weight: 900; margin-bottom: 20px; color: var(--text); display: flex; align-items: center; gap: 16px; }
    .output-line { 
      font-size: 1.5rem !important; font-family: 'SF Mono', Menlo, Consolas, monospace; font-weight: 700; 
      line-height: 1.6; margin: 16px 0; padding: 20px 24px; 
      background: rgba(255,255,255,0.95); border-radius: 16px; border-left: 6px solid var(--accent);
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    [data-theme="dark"] .output-line { background: rgba(255,255,255,0.25); }
    
    .unknown-term { background: #fee2e2 !important; color: #dc2626 !important; border-radius: 8px; padding: 6px 12px; font-weight: 800; border: 2px solid #fecaca; }
    .suggestion { background: #dbeafe; color: #1e40af; padding: 8px 16px; border-radius: 10px; font-size: 1.1rem; margin-left: 20px; font-weight: 600; }
    
    textarea { width: 100%; min-height: 160px; border-radius: 16px; padding: 24px; border: 2px solid var(--border); font-family: inherit; font-size: 1.15rem; resize: vertical; transition: all 0.3s; line-height: 1.6; }
    textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 4px rgba(59,130,246,0.2); }
    .btn-group { display: flex; gap: 20px; flex-wrap: wrap; margin: 28px 0; }
    button { background: var(--accent); color: white; border: none; padding: 18px 36px; border-radius: 16px; font-size: 1.15rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 6px 20px rgba(59,130,246,0.4); min-height: 56px; }
    button:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(59,130,246,0.5); }
    
    h1 { font-size: 2.8rem; font-weight: 900; margin-bottom: 16px; background: linear-gradient(135deg, var(--accent), #1d4ed8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    h3 { font-size: 1.5rem; margin-bottom: 24px; color: var(--text); font-weight: 800; }
    .quote { background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(16,185,129,0.1)); border-left: 6px solid var(--accent); padding: 24px; border-radius: 16px; font-style: italic; font-size: 1.2rem; margin: 24px 0; }
    .hidden { display: none; }
    
    @media (max-width: 768px) { 
      body { padding: 16px; } .top-bar { padding: 12px 16px; flex-direction: column; gap: 12px; }
      .output-title { font-size: 1.5rem; } .output-line { font-size: 1.3rem !important; }
      h1 { font-size: 2.2rem; } button { padding: 16px 28px; font-size: 1.05rem; }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="toggle-group">
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:600">
        <input type="checkbox" id="darkToggle"> ğŸŒ™ Dark Mode
      </label>
    </div>
  </div>
  
  <div style="height: 85px;"></div>
  
  <div class="card">
    <h1>ğŸ§¶ Kerstins StrickÃ¼bersetzer</h1>
    <p style="font-size:1.2rem;color:var(--text-muted);margin-bottom:28px;line-height:1.7">
      DE â†” EN â†” FR â€¢ Kommas/Punkte/Semikolons trennen automatisch â€¢ Fehler werden farbig markiert
    </p>
    
    <textarea id="input" placeholder="âœ¨ Teste mit: Umschlag, 2 re zus., 3 li, k2t0g, xxx, yo, re, li"></textarea>
    
    <div class="btn-group">
      <button id="btn">ğŸš€ Ãœbersetzen</button>
      <button id="randomExample">ğŸ² ZufÃ¤lliges Beispiel (5-7 Schritte EN/FR)</button>
      <button id="clear">ğŸ—‘ï¸ Leeren</button>
    </div>
  </div>

  <div id="quote" class="quote hidden"></div>

  <div id="output" class="output-card">
    <div style="text-align:center;color:var(--text-muted);font-size:1.2rem;font-style:italic;padding:60px 20px">
      Gib Strickanweisungen ein und klicke â¬†ï¸ "Ãœbersetzen" 
    </div>
  </div>

  <script>
    // 40er ZITAT-DATENBANK
    const quotes = [
      "â€Stricken ist wie Atmen â€“ nur schÃ¶ner.â€œ â€“ Kerstin",
      "â€Jede Masche erzÃ¤hlt eine Geschichte.â€œ",
      "â€Geduld ist der Faden, der alles zusammenhÃ¤lt.â€œ",
      "â€Im Stricken findet die Seele Ruhe.â€œ",
      "â€Masche fÃ¼r Masche wird Magie sichtbar.â€œ",
      "â€Die beste Therapie: Nadeln und Wolle.â€œ",
      "â€Stricken heilt, was Worte nicht kÃ¶nnen.â€œ",
      "â€Jeder Umschlag birgt eine Ãœberraschung.â€œ",
      "â€Rechts, links, wieder rechts â€“ das Leben.â€œ",
      "â€Ein Schal wÃ¤rmt mehr als nur den Hals.â€œ",
      "â€Stricken verbindet Generationen.â€œ â€“ Oma",
      "â€Die Nadel tanzt, das Garn singt.â€œ",
      "â€Fehler? Das sind nur neue MÃ¶glichkeiten.â€œ",
      "â€Stricken macht die Welt weicher.â€œ",
      "â€Jede Masche ist ein kleiner Sieg.â€œ",
      "â€Im Rhythmus der Nadeln findet man sich.â€œ",
      "â€Wolle ist die beste Therapeutin.â€œ",
      "â€Stricken ist Meditation mit Farben.â€œ",
      "â€Ein Pullover voller Erinnerungen.â€œ",
      "â€Die Kunst des Wartens â€“ Stricken.â€œ",
      "â€Maschen wie Perlen auf einer Kette.â€œ",
      "â€Stricken schafft Ordnung im Chaos.â€œ",
      "â€Jeder Faden trÃ¤gt eine Geschichte.â€œ",
      "â€Die Nadel ist mÃ¤chtiger als das Schwert.â€œ",
      "â€Stricken: Kunst, die wÃ¤rmt.â€œ",
      "â€Immer eine Masche voraus denken.â€œ",
      "â€Wolle macht alles besser.â€œ",
      "â€Stricken ist Liebe in Reihen.â€œ",
      "â€Die Magie passiert zwischen den Nadeln.â€œ",
      "â€Jede Abnahme macht Platz fÃ¼r Neues.â€œ",
      "â€Stricken verbindet Herz und Hand.â€œ",
      "â€Die beste Medizin kommt auf zwei Nadeln.â€œ",
      "â€Masche fÃ¼r Masche zum perfekten Muster.â€œ",
      "â€Stricken heilt die Seele.â€œ",
      "â€Wolle: weich, warm, wunderbar.â€œ",
      "â€Im Stricken steckt die Zeit still.â€œ",
      "â€Nadelklick â€“ und die Welt ist gut.â€œ",
      "â€Stricken ist mein Lieblingszauber.â€œ"
    ];

    // ERWEITERTE DICT
    const dict = [
      {de:"rechte masche|re",en:"knit|k",fr:"maille endroit|m.end.",suggest:["rechts stricken"]},
      {de:"linke masche|li",en:"purl|p",fr:"maille envers|m.env.",suggest:["links stricken"]},
      {de:"umschlag|u",en:"yarn over|yo",fr:"jetÃ©",suggest:["fadenumschlag"]},
      {de:"2 zusammen rechts",en:"k2tog",fr:"2 m. ens. Ã  l'end.",suggest:["abnahme rechts"]},
      {de:"2 zusammen links",en:"p2tog",fr:"2 m. ens. Ã  l'env.",suggest:["abnahme links"]},
      {de:"1 re 1 li bis ende",en:"k1 p1 rib",fr:"1 m.end. 1 m.env. jusqu'Ã  la fin"},
      {de:"verdopple|kfb",en:"knit front back|kfb",fr:"augmenter 1 m.",suggest:["zunahme"]},
      {de:"masche aufnehmen|m1",en:"make 1|m1",fr:"augmenter 1 m.",suggest:["zunahme"]}
    ];

    let lastTranslationTime = 0;
    let showedQuote = false;

    function showRandomQuote() {
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById('quote').innerHTML = `<q>${quote}</q>`;
      document.getElementById('quote').classList.remove('hidden');
      showedQuote = true;
    }

    function normalize(text) {
      return text.toLowerCase().replace(/[;:.]/g,',').replace(/,\s*,/g,',').replace(/[,\s]+/g,',').replace(/^,|,$/g,'').split(',').filter(Boolean);
    }

    function detectLang(chunk) {
      const deScore = (chunk.match(/(re|li|umschlag|zusa|zusammen)/gi)||[]).length;
      const enScore = (chunk.match(/(k|p|yo|tog|knit|purl)/gi)||[]).length;
      const frScore = (chunk.match(/(end|env|jetÃ©|m\.)/gi)||[]).length;
      return deScore > enScore && deScore > frScore ? 'de' : enScore > frScore ? 'en' : 'fr';
    }

    function findMatches(chunks) {
      const results = [], warnings = [], unknowns = [];
      chunks.forEach(chunk => {
        let found = false, bestMatch = null, confidence = 0;
        for(let entry of dict) {
          const deWords = entry.de.split('|'), enWords = entry.en.split('|'), frWords = entry.fr.split('|');
          if(deWords.some(w=>chunk.includes(w)) || enWords.some(w=>chunk.includes(w)) || frWords.some(w=>chunk.includes(w))) {
            const matchLang = detectLang(chunk);
            if((matchLang==='de' && deWords.some(w=>chunk.includes(w))) || 
               (matchLang==='en' && enWords.some(w=>chunk.includes(w))) || 
               (matchLang==='fr' && frWords.some(w=>chunk.includes(w)))) {
              bestMatch = entry; confidence = 0.95; found = true; break;
            } else confidence = 0.65;
          }
        }
        if(found && bestMatch) results.push({chunk, entry: bestMatch});
        else if(confidence > 0.6) warnings.push({chunk, entry: bestMatch});
        else unknowns.push(chunk);
      });
      return {results, warnings, unknowns};
    }

    function renderOutput({results, warnings, unknowns}) {
      let html = '';
      
      // DETAILLIERTE FEHLER
      if(warnings.length) {
        html += `<div class="output-section warning">
          <div class="output-title">âš ï¸ ${warnings.length} mÃ¶glicherweise unsichere Ãœbersetzung(en)</div>
          <div class="output-line">Betroffene Begriffe: ${warnings.map(w=>`<span class="unknown-term">${w.chunk}</span>`).join(', ')}</div>
          <div class="output-line">ğŸ’¡ Tipp: ÃœberprÃ¼fe Schreibweise oder probiere Alternativen aus der Begriffstabelle</div>
        </div>`;
      }
      
      if(unknowns.length) {
        html += `<div class="output-section error">
          <div class="output-title">âŒ ${unknowns.length} unbekannte Begriffe</div>
          <div class="output-line">Nicht erkannt: ${unknowns.map(u=>`<span class="unknown-term">${u}</span>`).join(', ')}</div>
          <div class="output-line">ğŸ” VorschlÃ¤ge: <span class="suggestion">re, li, Umschlag, k2tog, yo, jetÃ©</span></div>
          <div style="font-size:1.1rem;margin-top:16px;color:var(--text-muted)">Probiere den ğŸ² Zufallsbeispiel-Button fÃ¼r korrekte Syntax</div>
        </div>`;
      }
      
      // SICHERE ÃœBERSETZUNGEN
      if(results.length) {
        html += `<div class="output-section de"><div class="output-title">ğŸ‡©ğŸ‡ª Deutsch</div>${results.map(r=>`<div class="output-line">${r.entry.de.split('|')[0]}</div>`).join('')}</div>`;
        html += `<div class="output-section en"><div class="output-title">ğŸ‡ºğŸ‡¸ English</div>${results.map(r=>`<div class="output-line">${r.entry.en.split('|')[0]}</div>`).join('')}</div>`;
        html += `<div class="output-section fr"><div class="output-title">ğŸ‡«ğŸ‡· FranÃ§ais</div>${results.map(r=>`<div class="output-line">${r.entry.fr.split('|')[0]}</div>`).join('')}</div>`;
      }
      
      return html || '<div style="text-align:center;padding:80px;color:var(--text-muted)"><div style="font-size:2.5rem;margin-bottom:24px">ğŸ¯</div>Keine Treffer gefunden.<br><strong style="color:var(--accent);font-size:1.3rem">Probiere: "re, li, Umschlag, k2tog, yo" oder klicke ğŸ² ZufÃ¤lliges Beispiel</strong></div>';
    }

    function doTranslate() {
      const now = Date.now();
      if(now - lastTranslationTime < 1000) return; // Debounce
      lastTranslationTime = now;
      
      const input = document.getElementById('input').value;
      if(!input.trim()) return;
      
      const chunks = normalize(input);
      const analysis = findMatches(chunks);
      
      document.getElementById('output').innerHTML = renderOutput(analysis);
      
      // NEUES ZITAT NUR BEI NEUER ÃœBERSETZUNG
      if(!showedQuote || Math.random() < 0.3) {
        showRandomQuote();
      }
    }

    // ZUFÃ„LLIGE BEISPIELE (5-7 Schritte, EN/FR)
    document.getElementById('randomExample').addEventListener('click', ()=>{
      const enExamples = [
        "k2, yo, k2tog, p2, k1 p1 rib, kfb, p2tog",
        "p1, k2tog, yo, k4, p2tog tbl, kfb, k1",
        "kfb, p2, k2tog, yo, p1, k1 tbl, ssk",
        "yo, k3, p2tog, kfb, ssk, k2, p2tog tbl",
        "k1 p1 rib 6 rows, k2tog, yo, kfb, p2",
        "p2tog, k4, yo, ssk, kfb, p1, k1 tbl"
      ];
      const frExamples = [
        "2 m.end., jetÃ©, 2 ens.end., 2 m.env., 1 end 1 env jusqu'Ã  fin",
        "1 m.env., 2 ens.end., jetÃ©, 4 m.end., 2 ens.env., augmenter",
        "augmenter, 2 m.env., 2 ens.end., jetÃ©, diminuer end, k1",
        "jetÃ©, 3 m.end., 2 ens.env., augmenter, 2 ens.end., 2 m.env.",
        "1 end 1 env 6 rangs, 2 ens.end., jetÃ©, augmenter, 2 m.env."
      ];
      
      const allExamples = [...enExamples, ...frExamples];
      const randomExample = allExamples[Math.floor(Math.random() * allExamples.length)];
      document.getElementById('input').value = randomExample;
      doTranslate();
    });

    // EVENT LISTENER
    document.getElementById('btn').addEventListener('click', doTranslate);
    document.getElementById('clear').addEventListener('click', ()=> {
      document.getElementById('input').value = '';
      document.getElementById('output').innerHTML = '<div style="text-align:center;padding:60px;color:var(--text-muted)">Bereit fÃ¼r neue Strickanweisungen â¬†ï¸</div>';
      document.getElementById('quote').classList.add('hidden');
    });

    document.getElementById('darkToggle').addEventListener('change', e=>document.documentElement.setAttribute('data-theme', e.target.checked?'dark':''));
    
    // ENTER TASTATUR-SUPPORT
    document.getElementById('input').addEventListener('keydown', e=>{
      if(e.key === 'Enter' && e.ctrlKey) doTranslate();
    });
  </script>
</body>
</html>
