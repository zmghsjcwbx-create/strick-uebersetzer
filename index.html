<!DOCTYPE html>
<html lang="de">
<head><title>Kerstins Strick-Dolmetscher</title></head>
<body>
<h1>Frohe Weihnachten 2025 – Dein Strick-Übersetzer: DE ↔ EN ↔ FR</h1>

<!-- Eingabe -->
<p><strong>Eingabe:</strong></p>
<textarea id="input" rows="3" cols="60"
  placeholder="z.B.: p1, k1 to end oder 1 li, 1 re bis Ende"></textarea><br>
<button id="btn">Übersetzen</button>

<!-- Ausgabe -->
<p><strong>Ausgabe:</strong></p>
<div id="output" style="border:1px solid #ccc;padding:8px;min-height:40px;"></div>

<hr>

<!-- Übersetzungstabelle immer sichtbar -->
<h2>Übersicht: Begriffe Deutsch / Englisch / Französisch</h2>
<table border="1" style="border-collapse:collapse;font-family:Arial;">
<tr><th>Deutsch</th><th>Englisch (US/UK)</th><th>Französisch</th><th>Bedeutung</th></tr>
<tr><td>rechts / re</td><td>knit / k</td><td>endroit / end. / m.end.</td><td>Rechte Masche</td></tr>
<tr><td>links / li</td><td>purl / p</td><td>envers / env. / m.env.</td><td>Linke Masche</td></tr>
<tr><td>zusammen / zus.</td><td>together / tog</td><td>ensemble / ens.</td><td>Zusammenstricken</td></tr>
<tr><td>Umschlag / U</td><td>yarn over / yo</td><td>jeté / j</td><td>Umschlag</td></tr>
<tr><td>2 re zus.</td><td>k2tog</td><td>2 m. ens. à l'end.</td><td>2 zusammen rechts</td></tr>
<tr><td>2 li zus.</td><td>p2tog</td><td>2 m. ens. à l'env.</td><td>2 zusammen links</td></tr>
<tr><td>bis Ende</td><td>to end</td><td>jusqu'à la fin</td><td>Bis Reihenende</td></tr>
<tr><td>Rippenmuster 1x1</td><td>1x1 rib</td><td>côtes 1x1</td><td>Abwechselnd 1 li, 1 re</td></tr>
<tr><td>Anschlag</td><td>cast on</td><td>monter</td><td>Maschen anschlagen</td></tr>
<tr><td>Abketten</td><td>bind off</td><td>rabattre</td><td>Maschen abketten</td></tr>
</table>
  
<script>
// Wörterbuch für Einzelbegriffe / feste Phrasen
const dict = [
  { de: "rechte masche",        en: "knit",              fr: "maille endroit" },
  { de: "linke masche",         en: "purl",              fr: "maille envers" },

  { de: "1 li, 1 re bis ende",  en: "p1, k1 to end",     fr: "1 m.env., 1 m.end. jusqu'à la fin" },
  { de: "1 re, 1 li bis ende",  en: "k1, p1 to end",     fr: "1 m.end., 1 m.env. jusqu'à la fin" },

  { de: "umschlag",             en: "yarn over",         fr: "jeté" },
  { de: "zunahme",              en: "increase",          fr: "augmentation" },
  { de: "masche aus dem querfaden zunehmen",
    en: "m1",                   fr: "augmenter 1 m dans le brin" },

  { de: "2 zusammen rechts",    en: "k2tog",             fr: "2 m. ens. à l'end." },
  { de: "2 zusammen links",     en: "p2tog",             fr: "2 m. ens. à l'env." },
  { de: "überzug rechts",       en: "ssk",               fr: "surjet simple à l'endroit" },

  { de: "anschlagen",           en: "cast on",           fr: "monter" },
  { de: "abketten",             en: "bind off",          fr: "rabattre" },
  { de: "bis ende",             en: "to end",            fr: "jusqu'à la fin" },

  { de: "rippenmuster 1x1",     en: "1x1 rib",           fr: "côtes 1x1" },
  { de: "rippenmuster 2x2",     en: "2x2 rib",           fr: "côtes 2x2" },
  { de: "kraus rechts",         en: "garter stitch",     fr: "point mousse" },
  { de: "glatt rechts",         en: "stocking stitch",   fr: "jersey endroit" },
  { de: "perlmuster",           en: "moss stitch",       fr: "point de riz" }
];

function normalize(str) {
  return str
    .toLowerCase()
    .replace(/[`´‘’]/g, "'")
    .replace(/\s+/g, " ")
    .trim();
}

function coreDe(entry) {
  const parts = normalize(entry.de).split(" ");
  return (parts[0] || "") + (parts[1] ? " " + parts[1] : "");
}

// Sprache des Chunks grob erkennen (für Warnungen)
function detectLang(chunk, entry) {
  const t = normalize(chunk);
  let scores = { de: 0, en: 0, fr: 0 };

  if (t.includes(normalize(entry.de))) scores.de += 2;
  if (t.includes(normalize(entry.en))) scores.en += 2;
  if (t.includes(normalize(entry.fr))) scores.fr += 2;

  if (/[äöüß]/.test(t)) scores.de += 1;
  if (/[àâçéèêëîïôùûüÿœ]/.test(t)) scores.fr += 1;
  if (/[a-z]/.test(t) && t.includes("k") && t.includes("p")) scores.en += 0.5;

  let best = "de";
  let bestScore = scores.de;
  for (const lang of ["en", "fr"]) {
    if (scores[lang] > bestScore) {
      best = lang;
      bestScore = scores[lang];
    }
  }
  return { best, scores };
}

// Generische Erkennung von "Zahl + Maschenart"
function matchNumericPattern(chunk) {
  const t = normalize(chunk);

  // Beispiele, die erkannt werden:
  //  "3 li", "4 re", "k2", "p3", "3 p", "4 k"
  const regex = /(\d+)\s*(li|re|k|p)/g;
  let matches = [];
  let m;
  while ((m = regex.exec(t)) !== null) {
    const count = m[1];
    const code  = m[2]; // li, re, k, p
    let base;

    if (code === "li" || code === "p") {
      base = { de: "linke masche", en: "purl", fr: "maille envers" };
    } else {
      base = { de: "rechte masche", en: "knit", fr: "maille endroit" };
    }

    matches.push({
      original: m[0],
      count,
      base
    });
  }
  return matches.length ? matches : null;
}

function matchChunkDirect(chunk) {
  const t = normalize(chunk);

  // 1. direkter Treffer in Wörterbuch
  for (const entry of dict) {
    if (
      t.includes(normalize(entry.de)) ||
      t.includes(normalize(entry.en)) ||
      t.includes(normalize(entry.fr))
    ) {
      return entry;
    }
  }

  // 2. über deutsches Kernwort
  for (const entry of dict) {
    const c = coreDe(entry);
    if (c && t.includes(c)) return entry;
  }

  return null;
}

function doTranslate() {
  const raw = document.getElementById('input').value;
  const cleaned = normalize(raw.replace(/[.;:]/g, ","));

  if (!cleaned) {
    document.getElementById('output').innerHTML =
      "Bitte eine Strickanweisung eingeben (Deutsch, Englisch oder Französisch).";
    return;
  }

  const chunks = cleaned
    .split(",")
    .map(c => c.trim())
    .filter(Boolean);

  let anyWarning = false;

  // Sammel-Listen pro Sprache
  let deParts = [];
  let enParts = [];
  let frParts = [];

  for (const chunk of chunks) {
    const numericMatches = matchNumericPattern(chunk);

    if (numericMatches) {
      numericMatches.forEach(match => {
        const c = match.count;
        const b = match.base;

        const deText = c + " " + (c === "1" ? b.de : b.de.replace("masche", "maschen"));
        const enText = (b.en === "knit" ? "k" : "p") + c;
        const frText = c + " " + (b.fr.startsWith("maille") && c !== "1"
          ? b.fr.replace("maille", "m.")
          : b.fr);

        deParts.push(deText);
        enParts.push(enText);
        frParts.push(frText);
      });
      continue;
    }

    const entry = matchChunkDirect(chunk);
    if (entry) {
      const langInfo = detectLang(chunk, entry);
      let expectedLang = "de";
      if (chunk.match(/\b(k|p|yo|ssk|k2tog|p2tog|m1)\b/i)) expectedLang = "en";
      if (/[àâçéèêëîïôùûüÿœ]/.test(chunk)) expectedLang = "fr";

      if (langInfo.best !== expectedLang && expectedLang !== "de") {
        anyWarning = true;
      }

      deParts.push(entry.de);
      enParts.push(entry.en);
      frParts.push(entry.fr);
    } else {
      anyWarning = true;
      deParts.push("[unbekannt: " + chunk + "]");
      enParts.push("[unknown: " + chunk + "]");
      frParts.push("[inconnu: " + chunk + "]");
    }
  }

  let header = "";
  if (anyWarning) {
    header = "<p style='color:red;'><strong>Hinweis: Übersetzungsfehler oder Ungenauigkeiten möglich. Bitte Eingabe prüfen.</strong></p>";
  }

  const html =
    header +
    "<h3>Deutsch</h3><p>"   + (deParts.join(", ") || "-") + "</p>" +
    "<h3>English</h3><p>"   + (enParts.join(", ") || "-") + "</p>" +
    "<h3>Français</h3><p>"  + (frParts.join(", ") || "-") + "</p>";

  document.getElementById('output').innerHTML = html;
}


    // kein numerisches Muster → Dictionary-Match
    const entry = matchChunkDirect(chunk);
    if (entry) {
      const langInfo = detectLang(chunk, entry);
      let expectedLang = "de";
      if (chunk.match(/\b(k|p|yo|ssk|k2tog|p2tog|m1)\b/i)) expectedLang = "en";
      if (/[àâçéèêëîïôùûüÿœ]/.test(chunk)) expectedLang = "fr";

      let warning = "";
      if (langInfo.best !== expectedLang && expectedLang !== "de") {
        warning = "<strong>Hinweis: Spracheingabe und erkannte Sprache passen nicht eindeutig zusammen – Übersetzungsfehler möglich.</strong><br>";
        anyWarning = true;
      }

      blocks.push(
        warning +
        "Eingabe-Teil: <strong>" + chunk + "</strong><br>" +
        "→ Deutsch: "   + entry.de + "<br>" +
        "→ English: "   + entry.en + "<br>" +
        "→ Français: "  + entry.fr
      );
    } else {
      blocks.push(
        "<strong>Keine eindeutige Zuordnung für:</strong> " + chunk +
        "<br>→ Bitte ggf. kürzer oder genauer eingeben."
      );
      anyWarning = true;
    }
  }

  let header = "";
  if (anyWarning) {
    header = "<p style='color:red;'><strong>Hinweis: Übersetzungsfehler oder Ungenauigkeiten möglich. Bitte Eingabe prüfen.</strong></p>";
  }

  document.getElementById('output').innerHTML = header + blocks.join("<hr>");
}

document.getElementById('btn').addEventListener('click', doTranslate);
</script>

</body>
</html>
