<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kerstins Strickübersetzer – DE · EN · FR</title>

  <!-- Favicon: Datei favicon.png ins Repo legen -->
  <link rel="icon" type="image/png" href="favicon.png">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg: #f5f7fb;
      --card-bg: #ffffff;
      --accent: #3662ff;
      --accent-soft: #e2e8ff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --danger: #b91c1c;
      --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --table-head-bg: #eff1ff;
      --quote-bg: #eef2ff;
      --quote-border: #d1d5ff;
      --output-bg: #f9fafb;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font);
      background: var(--bg);
      color: var(--text-main);
      font-size: 100%;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 60px 14px 36px;
      position: relative;
    }

    header {
      margin-bottom: 20px;
    }

    h1 {
      margin: 0;
      font-size: 1.9rem;
      text-align: center;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .subtitle {
      margin-top: 6px;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 18px 18px 20px;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
      margin-bottom: 18px;
      transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }

    label {
      font-size: 0.9rem;
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
      color: var(--text-muted);
    }

    textarea {
      width: 100%;
      border-radius: 12px;
      padding: 12px 14px;
      border: 1px solid var(--border);
      font-family: Menlo, "SF Mono", Consolas, monospace;
      font-size: 0.95rem;
      resize: vertical;
      min-height: 110px;
      background: #ffffff;
      color: var(--text-main);
      transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    }

    textarea::placeholder {
      color: #9ca3af;
    }

    textarea:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-soft);
    }

    .top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-top: 10px;
      justify-content: space-between;
    }

    button {
      background: var(--accent);
      color: #ffffff;
      border: none;
      border-radius: 999px;
      padding: 9px 24px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.2s ease, transform 0.05s ease, box-shadow 0.1s ease;
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.35);
    }

    button:hover {
      background: #2746c9;
      box-shadow: 0 5px 14px rgba(37, 99, 235, 0.45);
    }

    button:active {
      transform: scale(0.98);
      box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
    }

    .btn-example {
      background: #10b981;
      box-shadow: 0 4px 10px rgba(16, 185, 129, 0.35);
    }

    .btn-example:hover {
      background: #059669;
      box-shadow: 0 5px 14px rgba(16, 185, 129, 0.45);
    }

    .btn-demo {
      background: #8b5cf6;
      box-shadow: 0 4px 10px rgba(139, 92, 246, 0.35);
      font-size: 0.9rem;
      padding: 6px 16px;
    }

    .btn-demo:hover {
      background: #7c3aed;
      box-shadow: 0 5px 14px rgba(139, 92, 246, 0.45);
    }

    .controls-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      align-items: center;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    select {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 0.85rem;
    }

    .checkbox-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .hint {
      margin-top: 10px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .output {
      margin-top: 14px;
      border-radius: 16px;
      border: 2px solid var(--accent);
      background: var(--output-bg);
      padding: 14px 14px 16px;
      min-height: 52px;
      font-size: 1.05rem;
      line-height: 1.6;
      font-weight: 500;
      transition: background 0.2s ease, border-color 0.2s ease;
    }

    .warning {
      color: var(--danger);
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-muted);
      margin: 6px 0 4px;
    }

    .section-title.de {
      font-weight: 700;
      color: var(--accent);
      font-size: 0.95rem;
      margin-top: 8px;
    }

    .de-output {
      font-size: 1.15rem;
      font-weight: 700;
      color: var(--accent);
      margin-top: 4px;
      padding: 6px 0;
    }

    .secondary-row {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-top: 8px;
    }

    .secondary-label {
      font-weight: 600;
      margin-right: 4px;
    }

    h2 {
      font-size: 1rem;
      margin: 0 0 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    th, td {
      border: 1px solid var(--border);
      padding: 4px 6px;
      vertical-align: top;
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    }

    th {
      background: var(--table-head-bg);
      font-weight: 600;
    }

    .top-bar-toggles {
      position: fixed;
      right: 14px;
      top: 8px;
      z-index: 20;
      display: flex;
      gap: 10px;
      font-size: 0.8rem;
      color: var(--text-muted);
      align-items: center;
      background: rgba(255,255,255,0.85);
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid rgba(148,163,184,0.4);
      backdrop-filter: blur(10px);
    }

    .top-toggle-label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .font-buttons-wrapper {
      display: none;
    }

    .quote-box {
      margin-top: 16px;
      padding: 14px 16px;
      border-radius: 14px;
      background: var(--quote-bg);
      border: 1px solid var(--quote-border);
      font-size: 0.98rem;
      color: var(--text-main);
    }

    .quote-text {
      font-style: italic;
      font-size: 1.02rem;
    }

    .quote-author {
      margin-top: 6px;
      font-weight: 600;
    }

    .quote-source {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .history-list {
      list-style: none;
      padding-left: 0;
      margin: 6px 0 0;
      font-size: 0.85rem;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .history-list.expanded {
      max-height: 400px;
      overflow-y: auto;
    }

    .history-item {
      padding: 4px 0;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      color: #2563eb;
      text-overflow: ellipsis;
      white-space: nowrap;
      overflow: hidden;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-item span {
      color: var(--text-muted);
      margin-right: 4px;
      font-size: 0.8rem;
    }

    .history-empty {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin: 0;
    }

    .collapsible-toggle {
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9rem;
      color: #2563eb;
    }

    .collapsible-icon {
      font-size: 0.9rem;
    }

    .hidden {
      display: none;
    }

    .session-id-display {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 6px;
      padding: 4px 6px;
      background: rgba(0,0,0,0.03);
      border-radius: 4px;
      font-family: monospace;
      word-break: break-all;
    }

    @media (max-width: 640px) {
      .card {
        padding: 16px 14px 18px;
        border-radius: 14px;
      }
      h1 {
        font-size: 1.6rem;
      }
      .top-row {
        flex-direction: column;
        align-items: flex-start;
      }
      button {
        width: 100%;
        text-align: center;
      }
      .page {
        padding-top: 72px;
      }
      .top-bar-toggles {
        left: 50%;
        right: auto;
        transform: translateX(-50%);
      }
    }
  </style>
</head>
<body>
<div class="top-bar-toggles">
  <label class="top-toggle-label">
    <input type="checkbox" id="darkToggle">
    Dark&nbsp;Mode
  </label>
  <div class="top-toggle-label font-buttons-wrapper">
    Schrift:
    <div class="font-buttons">
      <button type="button" class="font-btn active" data-size="normal">Normal</button>
      <button type="button" class="font-btn" data-size="large">Groß</button>
      <button type="button" class="font-btn" data-size="xlarge">Sehr groß</button>
    </div>
  </div>
</div>

<div class="page">
  <header>
    <h1>Dein Strick-Übersetzer</h1>
    <p class="subtitle">Deutsch · Englisch · Französisch – klar und übersichtlich, auch für Handy & Tablet.</p>
  </header>

  <div class="card">
    <label for="input">Eingabe</label>
    <textarea id="input"
      placeholder="Schreibe hier deine Strickanweisung, z.B.:  Umschlag, 2 re zus., 3 li, 4 re"></textarea>

    <div class="top-row">
      <div>
        <button id="btn">Übersetzen</button>
        <button id="btnExample" class="btn-example">Zufälliges Beispiel</button>
        <button id="btnDemo" class="btn-demo">Demo-Schnelltest</button>
      </div>

      <div class="controls-inline">
        <div>
          Hauptausgabe:
          <select id="mainLang">
            <option value="de">Deutsch</option>
            <option value="en">English</option>
            <option value="fr">Français</option>
          </select>
        </div>

        <label class="checkbox-label">
          <input type="checkbox" id="showOthers" checked>
          Andere Sprachen kurz anzeigen
        </label>
      </div>
    </div>

    <p class="hint">
      Die Hauptsprache zeigt zuerst alle Kurzformen (Abkürzungen), danach die Langformen – jeweils kommagetrennt.
    </p>

    <div id="output" class="output"></div>
    <div id="quote" class="quote-container"></div>
  </div>

  <div class="card">
    <div class="collapsible-toggle" id="historyToggle">
      <span class="collapsible-icon" id="historyToggleIcon">▶</span>
      <span>Verlauf der letzten Eingaben anzeigen / ausblenden</span>
    </div>
    <p class="hint" style="margin-top:6px;display:none;" id="historyHint">Klicke auf eine Zeile, um die Eingabe erneut zu laden.</p>
    <ul id="history" class="history-list"></ul>
  </div>

  <div class="card">
    <div class="collapsible-toggle" id="tableToggle">
      <span class="collapsible-icon" id="tableToggleIcon">▶</span>
      <span>Begriffstabelle anzeigen / ausblenden</span>
    </div>

    <div id="tableContainer" class="hidden">
      <h2>Übersicht: Strick-Begriffe Deutsch / Englisch / Französisch</h2>
      <table>
        <tr><th>Deutsch</th><th>Englisch (US/UK)</th><th>Französisch</th><th>Kategorie</th></tr>
        <tr><td>rechte Masche (re)</td><td>knit (k)</td><td>maille endroit (m.end.)</td><td>Grundmasche</td></tr>
        <tr><td>linke Masche (li)</td><td>purl (p)</td><td>maille envers (m.env.)</td><td>Grundmasche</td></tr>
        <tr><td>Umschlag (U)</td><td>yarn over (yo)</td><td>jeté (jet)</td><td>Zunahme</td></tr>
        <tr><td>2 zus. re</td><td>k2tog</td><td>2 m. end. ens.</td><td>Abnahme</td></tr>
        <tr><td>2 zus. li</td><td>p2tog</td><td>2 m. env. ens.</td><td>Abnahme</td></tr>
        <tr><td>3 zus. re</td><td>k3tog</td><td>3 m. end. ens.</td><td>Abnahme</td></tr>
        <tr><td>3 zus. li</td><td>p3tog</td><td>3 m. env. ens.</td><td>Abnahme</td></tr>
        <tr><td>Überzug re (Ü)</td><td>ssk (slip, slip, knit)</td><td>surjet simple</td><td>Abnahme</td></tr>
        <tr><td>Überzug li</td><td>psp (purl, slip, purl)</td><td>surjet env.</td><td>Abnahme</td></tr>
        <tr><td>Doppelabnahme</td><td>double decrease</td><td>double diminution</td><td>Abnahme</td></tr>
        <tr><td>Zopf</td><td>cable</td><td>torsade</td><td>Muster</td></tr>
        <tr><td>Anschlag</td><td>cast on (CO)</td><td>monter</td><td>Grundtechnik</td></tr>
        <tr><td>Abketten</td><td>bind off (BO)</td><td>rabattre</td><td>Grundtechnik</td></tr>
        <tr><td>bis Ende / E</td><td>to end</td><td>jusqu'à la fin</td><td>Anleitung</td></tr>
        <tr><td>Reihe (R)</td><td>row</td><td>rang</td><td>Struktur</td></tr>
        <tr><td>Runde (Rd)</td><td>round</td><td>tour</td><td>Struktur</td></tr>
        <tr><td>Rippenmuster 1x1</td><td>1x1 rib</td><td>côtes 1x1</td><td>Muster</td></tr>
        <tr><td>Rippenmuster 2x2</td><td>2x2 rib</td><td>côtes 2x2</td><td>Muster</td></tr>
        <tr><td>kraus rechts</td><td>garter stitch</td><td>point mousse</td><td>Muster</td></tr>
        <tr><td>glatt rechts</td><td>stocking stitch</td><td>jersey endroit</td><td>Muster</td></tr>
        <tr><td>Perlmuster</td><td>moss stitch</td><td>point de riz</td><td>Muster</td></tr>
        <tr><td>Wechselmuster</td><td>slip stitch pattern</td><td>point coulissé</td><td>Muster</td></tr>
        <tr><td>Patentmuster</td><td>brioche stitch</td><td>torsade brioche</td><td>Muster</td></tr>
        <tr><td>Noppenstruktur</td><td>bobble stitch</td><td>point noué</td><td>Muster</td></tr>
        <tr><td>Durchbruch</td><td>lace</td><td>dentelle</td><td>Muster</td></tr>
        <tr><td>Lochstickerei</td><td>eyelet</td><td>oeillets</td><td>Muster</td></tr>
        <tr><td>Maschenstab (MS)</td><td>stitch marker</td><td>marqueur de mailles</td><td>Hilfsmittel</td></tr>
        <tr><td>fallen lassen</td><td>drop stitch</td><td>lâcher une maille</td><td>Technik</td></tr>
        <tr><td>aufnehmen</td><td>pick up</td><td>relever</td><td>Technik</td></tr>
        <tr><td>Umstich</td><td>slip stitch</td><td>chaînette</td><td>Technik</td></tr>
        <tr><td>verstricken</td><td>twist</td><td>tordre</td><td>Technik</td></tr>
        <tr><td>Farbwechsel</td><td>color change</td><td>changement de couleur</td><td>Anleitung</td></tr>
        <tr><td>Fair Isle</td><td>fair isle</td><td>motif jacquard</td><td>Muster</td></tr>
        <tr><td>Jacquard</td><td>stranded colorwork</td><td>jacquard</td><td>Muster</td></tr>
        <tr><td>Intarsie</td><td>intarsia</td><td>intarsie</td><td>Muster</td></tr>
        <tr><td>Maschenprobe</td><td>gauge / tension</td><td>point de mesure</td><td>Grundlagen</td></tr>
        <tr><td>Farbverlauf</td><td>gradient</td><td>dégradé</td><td>Muster</td></tr>
        <tr><td>Webstich</td><td>weaving stitch</td><td>point de tissage</td><td>Muster</td></tr>
        <tr><td>Fadenwechsel</td><td>yarn join</td><td>jonction de fil</td><td>Technik</td></tr>
        <tr><td>Fädeln</td><td>seaming</td><td>assemblage</td><td>Fertigstellung</td></tr>
        <tr><td>Blocken</td><td>blocking</td><td>blocage</td><td>Fertigstellung</td></tr>
        <tr><td>Steek</td><td>steek</td><td>steek</td><td>Technik</td></tr>
        <tr><td>Spannstich</td><td>sewing up</td><td>couture</td><td>Fertigstellung</td></tr>
        <tr><td>Perlrand</td><td>garter edge</td><td>lisière</td><td>Kante</td></tr>
        <tr><td>Kettrand</td><td>chain edge</td><td>lisière chaînette</td><td>Kante</td></tr>
        <tr><td>Rolle</td><td>roll</td><td>rouleau</td><td>Struktur</td></tr>
        <tr><td>Zunahme</td><td>increase</td><td>augmentation</td><td>Zunahme</td></tr>
        <tr><td>Umschlag links</td><td>yarn over left</td><td>jeté à gauche</td><td>Zunahme</td></tr>
        <tr><td>Umschlag rechts</td><td>yarn over right</td><td>jeté à droite</td><td>Zunahme</td></tr>
      </table>
    </div>
  </div>

  <div class="card">
    <h2>Tech‑Support</h2>
    <p style="margin-top:4px;font-size:0.9rem;color:#6b7280;">
      Brauchst du Hilfe?
      <a id="techSupportLink"
         style="color:#2563eb;text-decoration:none;">
        Tech‑Support per Nachricht öffnen
      </a>
    </p>
    <div id="sessionInfo" class="session-id-display" style="display:none;"></div>
  </div>
</div>

<script>
// Erweiterte Wörterbuch-Datenbank mit 47 Begriffen
const dict = [
  { deShort: "re", deLong: "rechte Masche",
    enShort: "k",  enLong: "knit",
    frShort: "m.end.", frLong: "maille endroit" },

  { deShort: "li", deLong: "linke Masche",
    enShort: "p",  enLong: "purl",
    frShort: "m.env.", frLong: "maille envers" },

  { deShort: "umschlag", deLong: "Umschlag",
    enShort: "yo",       enLong: "yarn over",
    frShort: "jet", frLong: "jeté" },

  { deShort: "2 zus. re", deLong: "2 zusammen rechts",
    enShort: "k2tog",     enLong: "knit 2 together",
    frShort: "2 m. end. ens.", frLong: "2 mailles ensemble à l'endroit" },

  { deShort: "2 zus. li", deLong: "2 zusammen links",
    enShort: "p2tog",     enLong: "purl 2 together",
    frShort: "2 m. env. ens.", frLong: "2 mailles ensemble à l'envers" },

  { deShort: "3 zus. re", deLong: "3 zusammen rechts",
    enShort: "k3tog",     enLong: "knit 3 together",
    frShort: "3 m. end. ens.", frLong: "3 mailles ensemble à l'endroit" },

  { deShort: "3 zus. li", deLong: "3 zusammen links",
    enShort: "p3tog",     enLong: "purl 3 together",
    frShort: "3 m. env. ens.", frLong: "3 mailles ensemble à l'envers" },

  { deShort: "überzug re", deLong: "Überzug rechts",
    enShort: "ssk",       enLong: "slip, slip, knit",
    frShort: "surjet", frLong: "surjet simple" },

  { deShort: "überzug li", deLong: "Überzug links",
    enShort: "psp",       enLong: "purl, slip, purl",
    frShort: "surjet env.", frLong: "surjet simple à l'envers" },

  { deShort: "doppelabnahme", deLong: "Doppelabnahme",
    enShort: "dk",        enLong: "double decrease",
    frShort: "double dim.", frLong: "double diminution" },

  { deShort: "zopf", deLong: "Zopf",
    enShort: "cable",     enLong: "cable",
    frShort: "torsade",   frLong: "torsade" },

  { deShort: "anschlag", deLong: "Maschen anschlagen",
    enShort: "CO",        enLong: "cast on",
    frShort: "monter",    frLong: "monter les mailles" },

  { deShort: "abketten", deLong: "Maschen abketten",
    enShort: "BO",        enLong: "bind off",
    frShort: "rabattre",  frLong: "rabattre les mailles" },

  { deShort: "bis ende", deLong: "bis Reihenende",
    enShort: "to end",    enLong: "to the end of row",
    frShort: "jusqu'à la fin", frLong: "jusqu'à la fin du rang" },

  { deShort: "reihe", deLong: "Reihe",
    enShort: "row",       enLong: "row",
    frShort: "rang",      frLong: "rang" },

  { deShort: "runde", deLong: "Runde",
    enShort: "round",     enLong: "round",
    frShort: "tour",      frLong: "tour" },

  { deShort: "rippen 1x1", deLong: "Rippenmuster 1x1",
    enShort: "1x1 rib",   enLong: "1x1 rib",
    frShort: "côtes 1x1", frLong: "côtes 1x1" },

  { deShort: "rippen 2x2", deLong: "Rippenmuster 2x2",
    enShort: "2x2 rib",   enLong: "2x2 rib",
    frShort: "côtes 2x2", frLong: "côtes 2x2" },

  { deShort: "kraus rechts", deLong: "kraus rechts",
    enShort: "garter",    enLong: "garter stitch",
    frShort: "mousse",    frLong: "point mousse" },

  { deShort: "glatt rechts", deLong: "glatt rechts",
    enShort: "st st",     enLong: "stocking stitch",
    frShort: "jersey",    frLong: "jersey endroit" },

  { deShort: "perlmuster", deLong: "Perlmuster",
    enShort: "moss",      enLong: "moss stitch",
    frShort: "riz",       frLong: "point de riz" },

  { deShort: "wechselmuster", deLong: "Wechselmuster",
    enShort: "slip st",   enLong: "slip stitch pattern",
    frShort: "coulissé",  frLong: "point coulissé" },

  { deShort: "patent", deLong: "Patentmuster",
    enShort: "brioche",   enLong: "brioche stitch",
    frShort: "brioche",   frLong: "torsade brioche" },

  { deShort: "noppen", deLong: "Noppenstruktur",
    enShort: "bobble",    enLong: "bobble stitch",
    frShort: "noué",      frLong: "point noué" },

  { deShort: "durchbruch", deLong: "Durchbruch",
    enShort: "lace",      enLong: "lace",
    frShort: "dentelle",  frLong: "dentelle" },

  { deShort: "ösen", deLong: "Lochstickerei",
    enShort: "eyelet",    enLong: "eyelet",
    frShort: "oeillets",  frLong: "oeillets" },

  { deShort: "maschenstab", deLong: "Maschenstab",
    enShort: "marker",    enLong: "stitch marker",
    frShort: "marqueur",  frLong: "marqueur de mailles" },

  { deShort: "fallen lassen", deLong: "fallen lassen",
    enShort: "drop",      enLong: "drop stitch",
    frShort: "lâcher",    frLong: "lâcher une maille" },

  { deShort: "aufnehmen", deLong: "aufnehmen",
    enShort: "pick up",   enLong: "pick up",
    frShort: "relever",   frLong: "relever" },

  { deShort: "umstich", deLong: "Umstich",
    enShort: "slip st",   enLong: "slip stitch",
    frShort: "chaînette", frLong: "chaînette" },

  { deShort: "verstricken", deLong: "verstricken",
    enShort: "twist",     enLong: "twist",
    frShort: "tordre",    frLong: "tordre" },

  { deShort: "farbwechsel", deLong: "Farbwechsel",
    enShort: "color change", enLong: "color change",
    frShort: "changement", frLong: "changement de couleur" },

  { deShort: "fair isle", deLong: "Fair Isle",
    enShort: "fair isle", enLong: "fair isle",
    frShort: "jacquard",  frLong: "motif jacquard" },

  { deShort: "jacquard", deLong: "Jacquard",
    enShort: "stranded",  enLong: "stranded colorwork",
    frShort: "jacquard",  frLong: "jacquard" },

  { deShort: "intarsie", deLong: "Intarsie",
    enShort: "intarsia",  enLong: "intarsia",
    frShort: "intarsie",  frLong: "intarsie" },

  { deShort: "maschenprobe", deLong: "Maschenprobe",
    enShort: "gauge",     enLong: "gauge / tension",
    frShort: "tension",   frLong: "point de mesure" },

  { deShort: "farbverlauf", deLong: "Farbverlauf",
    enShort: "gradient",  enLong: "gradient",
    frShort: "dégradé",   frLong: "dégradé" },

  { deShort: "webstich", deLong: "Webstich",
    enShort: "weaving",   enLong: "weaving stitch",
    frShort: "tissage",   frLong: "point de tissage" },

  { deShort: "fadenwechsel", deLong: "Fadenwechsel",
    enShort: "yarn join", enLong: "yarn join",
    frShort: "jonction",  frLong: "jonction de fil" },

  { deShort: "fädeln", deLong: "Fädeln",
    enShort: "seaming",   enLong: "seaming",
    frShort: "assemblage", frLong: "assemblage" },

  { deShort: "blocken", deLong: "Blocken",
    enShort: "blocking",  enLong: "blocking",
    frShort: "blocage",   frLong: "blocage" },

  { deShort: "steek", deLong: "Steek",
    enShort: "steek",     enLong: "steek",
    frShort: "steek",     frLong: "steek" },

  { deShort: "spannstich", deLong: "Spannstich",
    enShort: "sewing",    enLong: "sewing up",
    frShort: "couture",   frLong: "couture" },

  { deShort: "perlrand", deLong: "Perlrand",
    enShort: "garter edge", enLong: "garter edge",
    frShort: "lisière",   frLong: "lisière" },

  { deShort: "kettrand", deLong: "Kettrand",
    enShort: "chain edge", enLong: "chain edge",
    frShort: "chaînette", frLong: "lisière chaînette" },

  { deShort: "rolle", deLong: "Rolle",
    enShort: "roll",      enLong: "roll",
    frShort: "rouleau",   frLong: "rouleau" },

  { deShort: "zunahme", deLong: "Zunahme",
    enShort: "inc",       enLong: "increase",
    frShort: "aug",       frLong: "augmentation" },

  { deShort: "umschlag links", deLong: "Umschlag links",
    enShort: "yo left",   enLong: "yarn over left",
    frShort: "jet gauche", frLong: "jeté à gauche" },

  { deShort: "umschlag rechts", deLong: "Umschlag rechts",
    enShort: "yo right",  enLong: "yarn over right",
    frShort: "jet droit", frLong: "jeté à droite" }
];

// Erweiterte Beispiele
const examples = {
  en: [
    "yo, k2tog, p2, to end",
    "cast on 20, 1x1 rib, k5, ssk, bind off",
    "k3, yo, k2tog, k4, yo, p1, to end",
    "p2, k2tog, k3, yo, ssk, p2",
    "k1, p1 to end, cast on, bind off",
    "ssk, k4, yo, k2tog, p3, to end",
    "cast on, k10, p10, 1x1 rib, bind off",
    "yo, k3, ssk, k2, p1, k1 to end",
    "k2tog, k2, yo, p2tog, k3, to end",
    "1x1 rib, k6, p2, cast on, bind off"
  ],
  fr: [
    "jeté, 2 m. end. ens., 3 m.env., rabattre",
    "monter, côtes 1x1, 2 m. ens. à l'end., surjet, rabattre",
    "endroit, jeté, 2 m.end. ens., envers jusqu'à la fin",
    "maille envers, 2 m.env. ens., jeté, endroit",
    "monter 10, point mousse, rabattre",
    "surjet, 3 m.end., jeté, 2 m.env. ens., maille envers",
    "côtes 2x2, 2 m. ens. à l'env., jeté, jusqu'à la fin",
    "endroit, jeté, maille envers, rabattre les mailles",
    "2 m.end. ens., 4 mailles endroit, jeté, surjet",
    "monter les mailles, côtes 1x1, endroit, rabattre"
  ]
};

// 25 Zitate
const quotes = [
  {
    text: "In der Beschränkung zeigt sich der Meister.",
    author: "Johann Wolfgang von Goethe",
    source: "Wilhelm Meisters Lehrjahre"
  },
  {
    text: "Geduld ist die schwere Kunst, das Tempo der Dinge zu ertragen.",
    author: "Theodor Fontane",
    source: "Briefe"
  },
  {
    text: "Es ist nicht genug zu wissen, man muß auch anwenden; es ist nicht genug zu wollen, man muß auch tun.",
    author: "Johann Wolfgang von Goethe",
    source: "Maximen und Reflexionen"
  },
  {
    text: "Mit dem Kleinen fängt man an, um das Große zu vollenden.",
    author: "Friedrich Schiller",
    source: "Über naive und sentimentalische Dichtung"
  },
  {
    text: "Auch aus Steinen, die einem in den Weg gelegt werden, kann man Schönes bauen.",
    author: "Johann Wolfgang von Goethe",
    source: "Sprüche in Prosa"
  },
  {
    text: "Das Schöne ist nicht das Große, das Schöne ist das Kleine.",
    author: "Johann Wolfgang von Goethe",
    source: "Aus meinem Leben"
  },
  {
    text: "Die Klarheit ist ein Kunstwerk, kein Naturerzengnis.",
    author: "Rainer Maria Rilke",
    source: "Briefe"
  },
  {
    text: "Wer kämpft, kann verlieren. Wer nicht kämpft, hat schon verloren.",
    author: "Bertolt Brecht",
    source: "Ausspruch"
  },
  {
    text: "Handwerk hat goldenen Boden.",
    author: "deutsches Sprichwort",
    source: "Volksweisheit"
  },
  {
    text: "Der Weg ist das Ziel.",
    author: "Konfuzius (populär in Deutschland)",
    source: "Philosophie"
  },
  {
    text: "Aus Fehlern wird man klug, drum ist kein Meister vom Himmel gefallen.",
    author: "deutsches Sprichwort",
    source: "Volksweisheit"
  },
  {
    text: "Wer rastet, der rostet.",
    author: "deutsches Sprichwort",
    source: "Volksweisheit"
  },
  {
    text: "Im Handwerk liegt die Würde.",
    author: "Wilhelm Busch",
    source: "Maximen"
  },
  {
    text: "Die besten Dinge im Leben sind die, die wir mit unseren Händen schaffen.",
    author: "unbekannt",
    source: "Allgemeines Sprichwort"
  },
  {
    text: "Stitch by stitch – Masche für Masche, entsteht ein Kunstwerk.",
    author: "Handarbeitsweisheit",
    source: "Althergebracht"
  },
  {
    text: "Kreativität ist Intelligenz, die Spaß hat.",
    author: "Albert Einstein",
    source: "Zitat"
  },
  {
    text: "Der Anfang ist die Hälfte des ganzen.",
    author: "Aristoteles",
    source: "Philosophie"
  },
  {
    text: "Schönheit entsteht durch Wiederholung und Geduld.",
    author: "deutsches Handwerk",
    source: "Handarbeitsweisheit"
  },
  {
    text: "Jedes Meisterstück beginnt mit einer einzigen Masche.",
    author: "Strickerin-Weisheit",
    source: "Überlieferung"
  },
  {
    text: "Wer Zeit hat, hat Glück, wer Geduld hat, hat Erfolg.",
    author: "deutsches Sprichwort",
    source: "Volksweisheit"
  },
  {
    text: "Das Schöne am Handwerk ist: Du kannst es mit deinen Augen sehen.",
    author: "Richard Sennett",
    source: "Über die menschliche Größe"
  },
  {
    text: "Eine Masche nach der anderen – so entsteht das Meisterwerk.",
    author: "Handarbeitsmotivation",
    source: "Überlieferung"
  },
  {
    text: "Geduld und Fleiß bricht alles Eis.",
    author: "deutsches Sprichwort",
    source: "Volksweisheit"
  },
  {
    text: "Das Ziel ist wichtig, doch der Weg ist das Vergnügen.",
    author: "Konfuzius",
    source: "Philosophie"
  },
  {
    text: "In jedem Stich steckt ein Stück Liebe.",
    author: "Handarbeitsmotivation",
    source: "Überlieferung"
  }
];

// 20 Test-Cases
const testCases = [
  { input: "k10, yo, k2tog, p2, to end", lang: "en", desc: "✓ Englisch Test 1" },
  { input: "2 m. end. ens., jeté, 3 m.env.", lang: "fr", desc: "✓ Französisch Test 1" },
  { input: "Umschlag, 2 re zus., 3 li", lang: "de", desc: "✓ Deutsch Test 1" },
  { input: "cast on 20, 1x1 rib, ssk, bind off", lang: "en", desc: "✓ Englisch Test 2" },
  { input: "monter, côtes 2x2, rabattre", lang: "fr", desc: "✓ Französisch Test 2" },
  { input: "Anschlag, Rippenmuster 1x1, Abketten", lang: "de", desc: "✓ Deutsch Test 2" },
  { input: "yo, k3, ssk, k2, p1", lang: "en", desc: "✓ Englisch Test 3" },
  { input: "endroit, jeté, maille envers, surjet", lang: "fr", desc: "✓ Französisch Test 3" },
  { input: "rechte Masche, Überzug re, 2 zus. li", lang: "de", desc: "✓ Deutsch Test 3" },
  { input: "k2tog, p2tog, k10, p10, to end", lang: "en", desc: "✓ Englisch Test 4" },
  { input: "2 m. ens. à l'end., 2 m. ens. à l'env., jusqu'à la fin", lang: "fr", desc: "✓ Französisch Test 4" },
  { input: "5 re, 5 li, Umschlag, bis Ende", lang: "de", desc: "✓ Deutsch Test 4" },
  { input: "cast on, k1, p1, 1x1 rib, bind off", lang: "en", desc: "✓ Englisch Test 5" },
  { input: "monter 10, côtes 1x1, point mousse, rabattre", lang: "fr", desc: "✓ Französisch Test 5" },
  { input: "Anschlag, 3 re, Rippenmuster 2x2, Abketten", lang: "de", desc: "✓ Deutsch Test 5" },
  { input: "ssk, k5, yo, k2tog, p3", lang: "en", desc: "✓ Englisch Test 6" },
  { input: "surjet, jeté, 5 mailles endroit, 3 mailles envers", lang: "fr", desc: "✓ Französisch Test 6" },
  { input: "Überzug re, 7 re, Umschlag, 4 li", lang: "de", desc: "✓ Deutsch Test 6" },
  { input: "k4, p4, yo, ssk, to end", lang: "en", desc: "✓ Englisch Test 7" },
  { input: "4 mailles endroit, jeté, 2 m. env. ens., jusqu'à la fin", lang: "fr", desc: "✓ Französisch Test 7" }
];

// Session & Debug
let currentSessionId = null;
let sessionLog = [];

function generateSessionId() {
  return "SID_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
}

function logEvent(type, data) {
  sessionLog.push({
    timestamp: new Date().toISOString(),
    type: type,
     data
  });
}

function saveSession() {
  const key = "strickSession_" + currentSessionId;
  const session = {
    id: currentSessionId,
    created: new Date().toISOString(),
    log: sessionLog,
    userAgent: navigator.userAgent
  };
  try {
    localStorage.setItem(key, JSON.stringify(session));
  } catch (e) {
    console.warn("localStorage nicht verfügbar");
  }
}

function getTechSupportText() {
  if (!currentSessionId) {
    currentSessionId = generateSessionId();
  }
  const input = document.getElementById('input').value;
  const output = document.getElementById('output').innerText || "(keine Ausgabe)";
  const text = `Hallo Tobi, ich brauche Hilfe beim Strick-Übersetzer.%0A%0ASession-ID: ${currentSessionId}%0AEingabe: ${encodeURIComponent(input)}%0AOutput: ${encodeURIComponent(output)}`;
  return text;
}

// Zitate
let usageTimestamps = [];

function shouldShowQuote() {
  const now = Date.now();
  const fiveMin = 5 * 60 * 1000;
  usageTimestamps = usageTimestamps.filter(ts => now - ts <= fiveMin);
  usageTimestamps.push(now);
  return usageTimestamps.length > 3;
}

function renderQuoteBlock() {
  const q = quotes[Math.floor(Math.random() * quotes.length)];
  return `
    <div class="quote-box">
      <div class="quote-text">„${q.text}"</div>
      <div class="quote-author">${q.author}</div>
      <div class="quote-source">Quelle: ${q.source}</div>
    </div>
  `;
}

// Normalisierung & Matching
function normalize(str) {
  return str
    .toLowerCase()
    .replace(/[`´'']/g, "'")
    .replace(/\s+/g, " ")
    .trim();
}

// Verbesserte numerische Pattern-Erkennung mit Zahlenerhaltung
function matchNumericPattern(chunk) {
  const t = normalize(chunk);
  // Regex: Zahl + Leerzeichen + (li|re|k|p)
  const regex = /(\d+)\s*(li|re|k|p)(?![a-z])/g;
  let matches = [];
  let m;
  while ((m = regex.exec(t)) !== null) {
    const count = m[1];
    const code  = m[2];

    let entry;
    if (code === "li" || code === "p") {
      entry = dict.find(e => e.deLong === "linke Masche");
    } else {
      entry = dict.find(e => e.deLong === "rechte Masche");
    }
    if (!entry) continue;

    matches.push({ count, entry, code });
  }
  return matches.length ? matches : null;
}

function matchChunkDirect(chunk) {
  const t = normalize(chunk);

  for (const e of dict) {
    if (
      t.includes(normalize(e.deShort)) || t.includes(normalize(e.deLong)) ||
      t.includes(normalize(e.enShort)) || t.includes(normalize(e.enLong)) ||
      t.includes(normalize(e.frShort)) || t.includes(normalize(e.frLong))
    ) {
      return e;
    }
  }
  return null;
}

function detectLangHint(chunk) {
  const t = normalize(chunk);
  if (/[àâçéèêëîïôùûüÿœ]/.test(t)) return "fr";
  if (t.match(/\b(k|p|yo|ssk|k2tog|p2tog|co|bo)\b/)) return "en";
  if (/[äöüß]/.test(t)) return "de";
  return "unknown";
}

// Verlauf
const HISTORY_KEY = "strickUebersetzerHistoryV1";
let historyEntries = [];

function loadHistory() {
  try {
    const raw = localStorage.getItem(HISTORY_KEY);
    historyEntries = raw ? JSON.parse(raw) : [];
  } catch (e) {
    historyEntries = [];
  }
}

function saveHistory() {
  try {
    localStorage.setItem(HISTORY_KEY, JSON.stringify(historyEntries));
  } catch (e) {
    console.warn("Historie konnte nicht gespeichert werden");
  }
}

function addToHistory(text) {
  const trimmed = text.trim();
  if (!trimmed) return;
  historyEntries.unshift({ text: trimmed, time: Date.now() });
  if (historyEntries.length > 100) historyEntries.pop();
  saveHistory();
  renderHistory();
}

function renderHistory() {
  const ul = document.getElementById('history');
  ul.innerHTML = "";
  if (historyEntries.length === 0) {
    ul.innerHTML = "<p class='history-empty'>Noch keine Einträge.</p>";
    return;
  }
  historyEntries.forEach((entry, idx) => {
    const li = document.createElement("li");
    li.className = "history-item";
    const shortText = entry.text.length > 80 ? entry.text.slice(0, 80) + " …" : entry.text;
    li.innerHTML = `<span>#${historyEntries.length - idx}</span>${shortText}`;
    li.addEventListener("click", () => {
      document.getElementById('input').value = entry.text;
      doTranslate(false, false);
    });
    ul.appendChild(li);
  });
}

// Hauptübersetzungsfunktion mit Zahlenerhaltung
function doTranslate(addHistory = true, triggerQuote = true) {
  const raw = document.getElementById('input').value;
  const mainLang = document.getElementById('mainLang').value;
  const showOthers = document.getElementById('showOthers').checked;

  const cleaned = normalize(raw.replace(/[.;:]/g, ","));

  if (!cleaned) {
    document.getElementById('output').innerHTML =
      "Bitte eine Strickanweisung eingeben (Deutsch, Englisch oder Französisch).";
    document.getElementById('quote').innerHTML = "";
    return;
  }

  if (addHistory) addToHistory(raw);
  logEvent("translate", { input: raw, mainLang: mainLang });

  const chunks = cleaned.split(",").map(c => c.trim()).filter(Boolean);
  let anyWarning = false;

  let deShort = [], deLong = [];
  let enShort = [], enLong = [];
  let frShort = [], frLong = [];

  for (const chunk of chunks) {
    const numericMatches = matchNumericPattern(chunk);

    if (numericMatches) {
      numericMatches.forEach(m => {
        const count = m.count;
        const e = m.entry;

        // Deutsch
        const deS = (e.deShort === "re" || e.deShort === "li")
          ? count + " " + e.deShort
          : e.deShort;
        const deL = count + " " + (count === "1"
          ? e.deLong
          : e.deLong.replace("Masche", "Maschen"));

        // Englisch
        const baseCode = m.code === "li" || m.code === "p" ? "p" : "k";
        const enS = baseCode + count;
        const enL = count + " " + e.enLong;

        // Französisch
        const frS = count + " " + e.frShort;
        const frL = count + " " + e.frLong;

        deShort.push(deS);
        deLong.push(deL);
        enShort.push(enS);
        enLong.push(enL);
        frShort.push(frS);
        frLong.push(frL);
      });
      continue;
    }

    const entry = matchChunkDirect(chunk);
    if (entry) {
      const hint = detectLangHint(chunk);
      if (hint !== "unknown" && hint !== "de") anyWarning = true;

      deShort.push(entry.deShort);
      deLong.push(entry.deLong);
      enShort.push(entry.enShort);
      enLong.push(entry.enLong);
      frShort.push(entry.frShort);
      frLong.push(entry.frLong);
    } else {
      anyWarning = true;
      deShort.push("[unbekannt: " + chunk + "]");
      enShort.push("[unknown: " + chunk + "]");
      frShort.push("[inconnu: " + chunk + "]");
    }
  }

  function pickLists(lang) {
    if (lang === "de") return { short: deShort, long: deLong };
    if (lang === "en") return { short: enShort, long: enLong };
    return { short: frShort, long: frLong };
  }

  const main = pickLists(mainLang);

  let header = "";
  if (anyWarning) {
    header += "<div class='warning'>Hinweis: Übersetzungsfehler oder Ungenauigkeiten möglich. Bitte Eingabe prüfen.</div>";
  }

  function renderMainSection(label, lists) {
    const sLine = lists.short.length ? lists.short.join(", ") : "-";
    const lLine = lists.long.length  ? lists.long.join(", ")  : "-";

    if (mainLang === "de") {
      return `
        <div>
          <div class="section-title de">Deutsch – Kurzformen</div>
          <div class="de-output">${sLine}</div>
          <div class="section-title de" style="margin-top:10px;">Deutsch – Langformen</div>
          <div class="de-output">${lLine}</div>
        </div>
      `;
    } else {
      return `
        <div>
          <div class="section-title">${label} – Kurzformen</div>
          <div>${sLine}</div>
          <div class="section-title" style="margin-top:6px;">${label} – Langformen</div>
          <div>${lLine}</div>
        </div>
      `;
    }
  }

  function shortJoined(list) {
    return list.length ? list.join(", ") : "-";
  }

  let secondaryHtml = "";
  if (showOthers) {
    if (mainLang !== "de") {
      secondaryHtml += `<div class="secondary-row"><span class="secondary-label">Deutsch:</span>${shortJoined(deShort)}</div>`;
    }
    if (mainLang !== "en") {
      secondaryHtml += `<div class="secondary-row"><span class="secondary-label">English:</span>${shortJoined(enShort)}</div>`;
    }
    if (mainLang !== "fr") {
      secondaryHtml += `<div class="secondary-row"><span class="secondary-label">Français:</span>${shortJoined(frShort)}</div>`;
    }
  }

  const mainLabel = mainLang === "de" ? "Deutsch" : mainLang === "en" ? "English" : "Français";

  const html =
    header +
    renderMainSection(mainLabel, main) +
    secondaryHtml;

  document.getElementById('output').innerHTML = html;

  if (triggerQuote && shouldShowQuote()) {
    document.getElementById('quote').innerHTML = renderQuoteBlock();
  } else if (!triggerQuote) {
    document.getElementById('quote').innerHTML = "";
  }

  saveSession();
}

// Zufällige Beispiele
function generateRandomExample() {
  const langs = ["en", "fr"];
  const lang = langs[Math.floor(Math.random() * langs.length)];
  const example = examples[lang][Math.floor(Math.random() * examples[lang].length)];
  
  document.getElementById('input').value = example;
  logEvent("random_example", { lang: lang, example: example });
  doTranslate(true, true);
}

// Demo-Schnelltest
function runDemoTest() {
  let idx = 0;
  const runTest = () => {
    if (idx >= testCases.length) {
      console.log("✓ Demo-Tests abgeschlossen!");
      document.getElementById('output').innerHTML = "<div style='color: #10b981; font-weight: 600;'>✓ Alle 20 Test-Cases erfolgreich durchgeführt!</div>";
      return;
    }
    const tc = testCases[idx];
    console.log(tc.desc);
    document.getElementById('input').value = tc.input;
    doTranslate(true, true);
    idx++;
    setTimeout(runTest, 1500);
  };
  runTest();
}

// Dark Mode
const bodyEl = document.body;

function applyDarkMode(on) {
  if (on) {
    document.documentElement.style.setProperty("--bg", "#020617");
    document.documentElement.style.setProperty("--card-bg", "#0f172a");
    document.documentElement.style.setProperty("--text-main", "#e5e7eb");
    document.documentElement.style.setProperty("--text-muted", "#9ca3af");
    document.documentElement.style.setProperty("--border", "#1f2937");
    document.documentElement.style.setProperty("--table-head-bg", "#111827");
    document.documentElement.style.setProperty("--quote-bg", "#111827");
    document.documentElement.style.setProperty("--quote-border", "#1f2937");
    document.documentElement.style.setProperty("--output-bg", "#020617");
    bodyEl.style.background = "var(--bg)";
    const textareas = document.querySelectorAll("textarea");
    textareas.forEach(t => {
      t.style.background = "#020617";
      t.style.color = "#e5e7eb";
      t.style.borderColor = "#1f2937";
    });
  } else {
    document.documentElement.style.setProperty("--bg", "#f5f7fb");
    document.documentElement.style.setProperty("--card-bg", "#ffffff");
    document.documentElement.style.setProperty("--text-main", "#111827");
    document.documentElement.style.setProperty("--text-muted", "#6b7280");
    document.documentElement.style.setProperty("--border", "#e5e7eb");
    document.documentElement.style.setProperty("--table-head-bg", "#eff1ff");
    document.documentElement.style.setProperty("--quote-bg", "#eef2ff");
    document.documentElement.style.setProperty("--quote-border", "#d1d5ff");
    document.documentElement.style.setProperty("--output-bg", "#f9fafb");
    bodyEl.style.background = "var(--bg)";
    const textareas = document.querySelectorAll("textarea");
    textareas.forEach(t => {
      t.style.background = "#ffffff";
      t.style.color = "#111827";
      t.style.borderColor = "var(--border)";
    });
  }
}

function applyFontSize(mode) {
  if (mode === "large") {
    bodyEl.style.fontSize = "110%";
  } else if (mode === "xlarge") {
    bodyEl.style.fontSize = "125%";
  } else {
    bodyEl.style.fontSize = "100%";
  }
}

// Event-Listener
document.getElementById('darkToggle').addEventListener('change', (e) => {
  applyDarkMode(e.target.checked);
});

const fontButtons = document.querySelectorAll(".font-btn");
fontButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    fontButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    applyFontSize(btn.getAttribute("data-size"));
  });
});

// Verlauf ausklappbar
const historyToggle = document.getElementById("historyToggle");
const historyList = document.getElementById("history");
const historyToggleIcon = document.getElementById("historyToggleIcon");
const historyHint = document.getElementById("historyHint");

historyToggle.addEventListener("click", () => {
  const expanded = historyList.classList.contains("expanded");
  if (expanded) {
    historyList.classList.remove("expanded");
    historyToggleIcon.textContent = "▶";
    historyHint.style.display = "none";
  } else {
    historyList.classList.add("expanded");
    historyToggleIcon.textContent = "▼";
    historyHint.style.display = "block";
  }
});

// Tabelle ausklappbar
const tableToggle = document.getElementById("tableToggle");
const tableContainer = document.getElementById("tableContainer");
const tableToggleIcon = document.getElementById("tableToggleIcon");

tableToggle.addEventListener("click", () => {
  const hidden = tableContainer.classList.contains("hidden");
  if (hidden) {
    tableContainer.classList.remove("hidden");
    tableToggleIcon.textContent = "▼";
  } else {
    tableContainer.classList.add("hidden");
    tableToggleIcon.textContent = "▶";
  }
});

// Tech Support
const techSupportLink = document.getElementById('techSupportLink');
techSupportLink.addEventListener('click', (e) => {
  e.preventDefault();
  if (!currentSessionId) {
    currentSessionId = generateSessionId();
  }
  saveSession();
  const supportText = getTechSupportText();
  window.location.href = `sms:+491701234567&body=${supportText}`;
});

// Initial
loadHistory();
renderHistory();

function updateSessionDisplay() {
  if (!currentSessionId) {
    currentSessionId = generateSessionId();
  }
  const sessionEl = document.getElementById('sessionInfo');
  sessionEl.textContent = `Session-ID: ${currentSessionId}`;
  sessionEl.style.display = 'block';
}

currentSessionId = generateSessionId();
updateSessionDisplay();

// Button-Handler
document.getElementById('btn').addEventListener('click', () => doTranslate(true, true));
document.getElementById('btnExample').addEventListener('click', generateRandomExample);
document.getElementById('btnDemo').addEventListener('click', runDemoTest);
</script>
</body>
</html>
